# ЁЯЫбя╕П XSS, SOP, CSRF - ржмрж╛ржВрж▓рж╛рзЯ ржмрзНржпрж╛ржЦрзНржпрж╛ ржУ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

---

## ЁЯФе рзз. XSS (Cross-Site Scripting)

### ЁЯУШ рж╕ржВржЬрзНржЮрж╛:
**XSS (Cross-Site Scripting)** ржПржХржЯрж┐ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржнржЩрзНржЧрзЗрж░ ржХрзМрж╢рж▓ ржпрзЗржЦрж╛ржирзЗ ржЖржХрзНрж░ржоржгржХрж╛рж░рзА ржХрзЛржиржУ ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯрзЗ ржХрзНрж╖рждрж┐ржХрж░ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ (рж╕рж╛ржзрж╛рж░ржгржд JavaScript) ржЗржиржЬрзЗржХрзНржЯ ржХрж░рзЗ ржПржмржВ рж╕рзЗржЯрж╛ ржЗржЙржЬрж╛рж░рзЗрж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржЪрж╛рж▓рж╛ржпрж╝ред

### ЁЯза ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг:
ржзрж░рзЛ, ржПржХржЯрж┐ ржЕржирж▓рж╛ржЗржи ржХржорзЗржирзНржЯ ржмржХрзНрж╕рзЗ ржХрзЗржЙ ржирж┐ржЪрзЗрж░ ржХрзЛржб рж▓рж┐ржЦрзЗ:
```html
<script>alert("Hacked!")</script>
```

ржпржжрж┐ ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯ ржЗржиржкрзБржЯ ржпрж╛ржЪрж╛ржЗ ржирж╛ ржХрж░рзЗ рж╕рж░рж╛рж╕рж░рж┐ рж╕рзЗржЯрж╛ ржжрзЗржЦрж╛ржпрж╝, рждрж╛рж╣рж▓рзЗ ржпрзЗржЗ ржЗржЙржЬрж╛рж░ ржУржЗ ржХржорзЗржирзНржЯ ржжрзЗржЦржмрзЗ, рждрж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржЪрж▓ржмрзЗред

### ЁЯФР ржХрзА ржХрзНрж╖рждрж┐ рж╣рждрзЗ ржкрж╛рж░рзЗ:
- ржХрзБржХрж┐ ржЪрзБрж░рж┐
- ржЗржЙржЬрж╛рж░рзЗрж░ ржирж╛ржорзЗ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГржд ржХрж╛ржЬ
- ржлрж┐рж╢рж┐ржВ ржмрж╛ ржнрзБрзЯрж╛ ржкрзЗржЗржЬрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрж╢ржи

### тЬЕ ржкрзНрж░рждрж┐рж░рзЛржз:
- ржЗржиржкрзБржЯ ржпрж╛ржЪрж╛ржЗ (Sanitization)
- Content Security Policy (CSP)
- HTTPOnly Cookies

---

## ЁЯЫбя╕П рзи. SOP (Same-Origin Policy)

### ЁЯУШ рж╕ржВржЬрзНржЮрж╛:
**Same-Origin Policy (SOP)** ржПржХржЯрж┐ ржмрзНрж░рж╛ржЙржЬрж╛рж░-ржирж┐рж░рзНржнрж░ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржирж┐ржпрж╝ржо ржпрж╛ ржмрж▓рзЗ, ржПржХ origin (ржкрзНрж░рзЛржЯрзЛржХрж▓ + ржбрзЛржорзЗржЗржи + ржкрзЛрж░рзНржЯ) ржерзЗржХрзЗ ржЕржирзНржп origin-ржП рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ ржмрж╛ рждржерзНржп ржкржбрж╝рж╛ **рж╕рж░рж╛рж╕рж░рж┐ ржирж┐рж╖рж┐ржжрзНржз**ред

### ЁЯза ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг:
рждрзБржорж┐ `https://mybank.com` ржП ржЖржЫрзЛ, ржПржЦржи ржпржжрж┐ ржХрзЛржи рж╕рзНржХрзНрж░рж┐ржкрзНржЯ `https://evil.com` ржерзЗржХрзЗ API ржХрж▓ ржХрж░рждрзЗ ржЪрж╛ржпрж╝ тАФ SOP рж╕рзЗржЗ ржХрж▓ ржмрзНрж▓ржХ ржХрж░ржмрзЗред

### тЬЕ Origin Components:
- Protocol (https/http)
- Domain (example.com)
- Port (:80, :443)

### ЁЯФР рж╕рзБржмрж┐ржзрж╛:
- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзНржпржХрзНрждрж┐ржЧржд ржбрзЗржЯрж╛ ржЕржирзНржп рж╕рж╛ржЗржЯ ржжрзНржмрж╛рж░рж╛ ржЪрзБрж░рж┐ рж╣ржУрзЯрж╛ ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржХрж░рзЗ
- Cross-origin scripting ржарзЗржХрж╛рзЯ

---

## ЁЯЫбя╕П рзй. CSRF (Cross-Site Request Forgery)

### ЁЯУШ рж╕ржВржЬрзНржЮрж╛:
**CSRF** рж╣рж▓рзЛ ржПржХржЯрж┐ ржЖржХрзНрж░ржоржг ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржирж┐ржЬрзЗ ржмрзБржЭрждрзЗ ржирж╛ ржкрж╛рж░рж▓рзЗржУ, рждрж╛ржжрзЗрж░ ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи ржжрж┐рзЯрзЗ ржХрзЛржиржУ ржЕржирж╛ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж╕рж╛ржмржорж┐ржЯ ржХрж░рж╛ рж╣рзЯред

### ЁЯза ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг:
рждрзБржорж┐ `yourbank.com` ржП рж▓ржЧржЗржи ржХрж░рж╛, ржПрж░ржкрж░ рждрзБржорж┐ ржПржХржЯрж╛ ржорзЗржЗрж▓рзЗ ржХрзНрж▓рж┐ржХ ржХрж░рж▓рзЗ ржирж┐ржЪрзЗрж░ ржХрзЛржб рж▓рзЛржб рж╣рзЯ:
```html
<img src="https://yourbank.com/transfer?to=hacker&amount=1000">
```

рждрзЛржорж╛рж░ рж▓ржЧржЗржи ржХрзБржХрж┐ ржерж╛ржХрж╛рзЯ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯржЯрж┐ ржмрзНржпрж╛ржВржХ ржЧрзНрж░рж╣ржг ржХрж░рзЗ ржПржмржВ ржЯрж╛ржХрж╛ ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржпрж╝ред

### ЁЯФР ржкрзНрж░рждрж┐ржХрж╛рж░:
- CSRF Token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛
- SameSite Cookies
- рж╢рзБржзрзБржорж╛рждрзНрж░ POST рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ рж╕ржВржмрзЗржжржирж╢рзАрж▓ ржбрзЗржЯрж╛ рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛

---

## ЁЯУК рждрзБрж▓ржирж╛ ржЯрзЗржмрж┐рж▓

| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп        | XSS                         | CSRF                             | SOP                           |
| ---------------- | --------------------------- | -------------------------------- | ----------------------------- |
| ржХрж╛ржжрзЗрж░ ржЙржкрж░ ржЖржХрзНрж░ржоржг | ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░       | ржЕржерзЗржиржЯрж┐ржХрзЗржЯрзЗржб ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА          | ржЕржирзНржп origin ржерзЗржХрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ    |
| ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ   | рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЗржиржЬрзЗржХрж╢ржи           | ржЗржЙржЬрж╛рж░рзЗрж░ ржкржХрзНрж╖ ржерзЗржХрзЗ ржлрзЗржЗржХ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ | ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржЕржирзНржп origin ржмрзНрж▓ржХ ржХрж░рзЗ |
| ржЗржЙржЬрж╛рж░ ржЬрж╛ржирзЗ ржХрж┐ржирж╛  | рж╕рж╛ржзрж╛рж░ржгржд ржирж╛                  | ржирж╛                               | ржирж╛                            |
| ржХрзНрж╖рждрж┐рж░ ржзрж░ржи       | рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЪрж╛рж▓рж╛ржирзЛ, ржХрзБржХрж┐ ржЪрзБрж░рж┐ | ржЯрж╛ржХрж╛ ржкрж╛ржарж╛ржирзЛ, ржЕржирж┐ржЪрзНржЫрж╛ржХрзГржд ржХрж╛ржЬ      | Unauthorized data blocking    |
| ржкрзНрж░рждрж┐ржХрж╛рж░         | ржЗржиржкрзБржЯ рж╕рзНржпрж╛ржирж┐ржЯрж╛ржЗржЬрзЗрж╢ржи, CSP    | CSRF Token, SameSite Cookie      | ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржирж┐ржЬрзЗржЗ ржкрзНрж░ржЯрзЗржХрж╢ржи ржжрзЗрзЯ   |

---

## ЁЯУМ рж╕рж╣ржЬрзЗ ржоржирзЗ рж░рж╛ржЦрж╛рж░ ржЯрж┐ржкрж╕:

- **XSS** = рж╣рзНржпрж╛ржХрж╛рж░ ржЗржЙржЬрж╛рж░рзЗрж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржХрзЛржб ржЪрж╛рж▓рж╛рзЯ  
- **CSRF** = рж╣рзНржпрж╛ржХрж╛рж░ ржЗржЙржЬрж╛рж░рзЗрж░ рж╣рзЯрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛рзЯ  
- **SOP** = ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржнрж┐ржирзНржи origin ржерзЗржХрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржмрзНрж▓ржХ ржХрж░рзЗ

---

## ЁЯУЭ ржЙржкрж╕ржВрж╣рж╛рж░:

ржПржЗ рждрж┐ржиржЯрж┐ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржХржирж╕рзЗржкрзНржЯ ржкрзНрж░рждрж┐ржЯрж┐ ржУржпрж╝рзЗржм ржбрзЗржнрзЗрж▓ржкрж╛рж░, рж╕рж╛ржЗржмрж╛рж░ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ рж▓рж╛рж░рзНржирж╛рж░, ржПржмржВ рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░ ржЗржЮрзНржЬрж┐ржирж┐ржпрж╝рж╛рж░рзЗрж░ ржЬрж╛ржирж╛ ржерж╛ржХрж╛ ржЕржкрж░рж┐рж╣рж╛рж░рзНржпред XSS ржПржмржВ CSRF ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржнрж┐рждрж░ ржерзЗржХрзЗ рж╣рзЯ, ржЖрж░ SOP рж╣рж▓рзЛ ржмрзНрж░рж╛ржЙржЬрж╛рж░-рж▓рзЗржнрзЗрж▓рзЗрж░ ржкрзНрж░рждрж┐рж░ржХрзНрж╖рж╛ ржмрзНржпржмрж╕рзНржерж╛ред



# ЁЯНк SameSite Cookie тАУ ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ ржУ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

---

## ЁЯФН SameSite Cookie ржХрзА?

**SameSite Cookie** ржПржХржЯрж┐ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржлрж┐ржЪрж╛рж░ ржпрж╛ ржмрзНрж░рж╛ржЙржЬрж╛рж░ржХрзЗ ржирж┐рж░рзНржжрзЗрж╢ ржжрзЗржпрж╝ тАФ **ржХржЦржи ржХрзЛржи ржУрзЯрзЗржмрж╕рж╛ржЗржЯ ржХрзБржХрж┐ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░ржмрзЗ ржПржмржВ ржХржЦржи ржкрж╛рж░ржмрзЗ ржирж╛**ред  
ржПржЯрж┐ Cross-Site Request Forgery (CSRF) ржПрж░ ржоржд ржЖржХрзНрж░ржоржг ржкрзНрж░рждрж┐рж░рзЛржзрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

---

## ЁЯУж SameSite Attribute ржПрж░ ржзрж░ржи

```http
Set-Cookie: sessionId=abc123; SameSite=Strict
```

### ЁЯФ╣ 1. `SameSite=Strict`  
тЬЕ ржХрзБржХрж┐ **рж╢рзБржзрзБ рждржЦржиржЗ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ**, ржпржЦржи ржЗржЙржЬрж╛рж░ рж╕рж░рж╛рж╕рж░рж┐ рж╕рзЗржЗ рж╕рж╛ржЗржЯрзЗ ржмрзНрж░рж╛ржЙржЬ ржХрж░ржЫрзЗред

ЁЯУМ ржЙржжрж╛рж╣рж░ржг:  
рждрзБржорж┐ `yourbank.com` ржирж┐ржЬ рж╣рж╛рждрзЗ ржЯрж╛ржЗржк ржХрж░рзЗ ржкрзНрж░ржмрзЗрж╢ ржХрж░рж▓рзЗ ржХрзБржХрж┐ ржпрж╛ржмрзЗ,  
ржХрж┐ржирзНрждрзБ ржпржжрж┐ ржХрзЗржЙ `facebook.com` ржерзЗржХрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рзЗ ржкрж╛ржарж╛рзЯ тАФ ржХрзБржХрж┐ **ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ ржирж╛**ред

---

### ЁЯФ╣ 2. `SameSite=Lax`  
тЬЕ рж╢рзБржзрзБржорж╛рждрзНрж░ **GET request ржПрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржХрзБржХрж┐ ржпрж╛ржмрзЗ**, POST, PUT ржЗрждрзНржпрж╛ржжрж┐рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржпрж╛ржмрзЗ ржирж╛ред

ЁЯУМ ржЙржжрж╛рж╣рж░ржг:  
рждрзБржорж┐ `yourbank.com` ржПрж░ рж▓рж┐ржВржХрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рж▓рзЗ ржХрзБржХрж┐ ржпрж╛ржмрзЗ,  
ржХрж┐ржирзНрждрзБ ржпржжрж┐ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж╣рзЯрзЗ ржлрж░рзНржо рж╕рж╛ржмржорж┐ржЯ рж╣рзЯ тАФ ржХрзБржХрж┐ **ржпрж╛ржмрзЗ ржирж╛**ред

---

### ЁЯФ╣ 3. `SameSite=None`  
тЬЕ ржХрзБржХрж┐ рж╕ржм cross-site request ржП ржпрж╛ржмрзЗ,  
тЭЧ ржХрж┐ржирзНрждрзБ `Secure` flag ржЕржмрж╢рзНржпржЗ ржерж╛ржХрждрзЗ рж╣ржмрзЗред

ЁЯУМ ржЙржжрж╛рж╣рж░ржг:  
рждрзБржорж┐ `yourbank.com` ржПрж░ iframe ржмрж╛ ржерж╛рж░рзНржб-ржкрж╛рж░рзНржЯрж┐ рж╕рж╛ржЗржЯрзЗ API ржХрж▓ ржХрж░рж▓рзЗ ржХрзБржХрж┐ ржпрж╛ржмрзЗред

```http
Set-Cookie: sessionId=xyz123; SameSite=None; Secure
```

---

## ЁЯза ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг:

ржзрж░рзЛ рждрзБржорж┐ `facebook.com` рж▓ржЧржЗржи ржХрж░рзЗ ржЖржЫрзЛред  
рж╣рзНржпрж╛ржХрж╛рж░ ржпржжрж┐ `evil.com` ржерзЗржХрзЗ рждрзЛржорж╛рж░ ржирж╛ржорзЗ ржХрж┐ржЫрзБ POST ржХрж░рждрзЗ ржЪрж╛рзЯ (ржпрзЗржоржи тАФ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ), рждрж╛рж╣рж▓рзЗ:

- ржпржжрж┐ SameSite=Strict тЖТ ржХрзБржХрж┐ ржпрж╛ржмрзЗ ржирж╛ тЖТ ржирж┐рж░рж╛ржкржж  
- ржпржжрж┐ SameSite=None тЖТ ржХрзБржХрж┐ ржпрж╛ржмрзЗ тЖТ ржЭрзБржБржХрж┐ ржмрзЗрж╢рж┐

---

## ЁЯФР рж╕рзБржмрж┐ржзрж╛ ржХрзА?

- CSRF (Cross-Site Request Forgery) ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛
- ржерж╛рж░рзНржб-ржкрж╛рж░рзНржЯрж┐ ржХрзБржХрж┐рж░ ржЕржкржмрзНржпржмрж╣рж╛рж░ ржХржорж╛рзЯ
- ржЗржЙржЬрж╛рж░ ржкрзНрж░рж╛ржЗржнрзЗрж╕рж┐ ржмрзГржжрзНржзрж┐ ржХрж░рзЗ

---

## ЁЯУМ рж╕рж╣ржЬрзЗ ржоржирзЗ рж░рж╛ржЦрж╛рж░ ржЯрж┐ржкрж╕:

| Attribute     | ржХржмрзЗ ржХрзБржХрж┐ ржпрж╛ржмрзЗ                   | рж╕рж┐ржХрж┐ржЙрж░? | Notes                       |
|---------------|----------------------------------|---------|-----------------------------|
| `Strict`      | рж╢рзБржзрзБ ржирж┐ржЬрзЗрж░ рж╕рж╛ржЗржЯрзЗ                 | ЁЯЯв рж╣рзНржпрж╛ржБ | рж╕ржмржЪрзЗрзЯрзЗ ржХрзЬрж╛ ржирж┐рж░рж╛ржкрждрзНрждрж╛       |
| `Lax`         | GET request ржП ржХрзБржХрж┐ ржпрж╛ржмрзЗ          | ЁЯЯб ржорж╛ржЭрж╛рж░рж┐ | Default behaviour ржЕржирзЗржХ рж╕ржорзЯ |
| `None + Secure`| рж╕ржм request ржП ржХрзБржХрж┐ ржпрж╛ржмрзЗ          | ЁЯФ┤ ржирж╛     | рж╢рзБржзрзБ HTTPS ржПрж░ ржЬржирзНржп          |

---

## ЁЯУЭ ржЙржкрж╕ржВрж╣рж╛рж░:

SameSite Cookie рж╣рж▓рзЛ ржУрзЯрзЗржм ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп ржПржХржзрж░ржирзЗрж░ ржЧрзЗржЯржХрж┐ржкрж╛рж░ред ржПржЯрж┐ ржарж┐ржХ ржХрж░рзЗ ржжрзЗрзЯ ржХрзЛржи ржЕржмрж╕рзНржерж╛ржпрж╝ ржХрзБржХрж┐ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред ржирж┐рж░рж╛ржкржж ржУрзЯрзЗржм ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржПрж░ рж╕ржарж┐ржХ ржмрзНржпржмрж╣рж╛рж░ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред

